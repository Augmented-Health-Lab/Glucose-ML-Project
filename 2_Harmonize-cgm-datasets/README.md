# 2_Harmonize-cgm-datasets - /{Dataset}_extract-glucose-data.py & /{Dataset}_metadata.py

This directory contains the harmonization helper scripts called to standardize raw Continuous Glucose Monitoring (CGM) data for Glucose-ML compatible projects.

Each dataset directory contains two scripts:

* `{Dataset}_extract-glucose-data.py`
* `{Dataset}_metadata.py`

These scripts are typically executed automatically by `auto-harmonize-CGM-datasets.py`, but can be executed individually in sequential order if desired.

---

### 1. `{Dataset}_extract-glucose-data.py`

**Purpose:**
Cleans and converts raw dataset files into standardized, per-subject CGM CSV files.

### Input:
The raw, unzipped dataset download located in `Auto-scripts/Original-Glucose-ML-datasets/{Dataset}_raw_data/` (see **Adding a Controlled-Access Dataset** below for step-by-step set-up)

### Output:
Standardized files are written to: `Standardized-datasets/<Dataset>/<subject_id>.csv`
Each csv output file contains exactly two columns: timestamp, glucose_value_mg_dl

### What this script does:

* Handles dataset-specific file formats and quirks
* Renames columns to the project standard: timestamp, glucose_value_mg_dl
* If necessary, converts all CGM readings to mg/dL (rounds to nearest tenth).
* Converts timestamps to pandas datetime format.
* Drops rows with missing timestamps or glucose values
* Writes one CSV per subject

### Usage:

```bash
python <Dataset>_extract-glucose-data.py <raw_dataset_directory>
```

---

### 2. `{Dataset}_metadata.py`

**Purpose:**
Calculates subject-level summary statistics from the standardized CGM files.

### Input:
The standardized CSV outputs generated by `{Dataset}_extract-glucose-data.py`.

### Output:
A single metadata file per dataset: `Standardized-metadata/<Dataset>_metadata_calcs.csv`

### What this script calculates (per subject):

* Total number of glucose records
* Average glucose level (mg/dL)
* Number of unique days with CGM data

### Usage:

```bash
python <Dataset>_metadata.py Standardized-datasets/<Dataset>
```

---

## Adding a Controlled-Access Dataset

To add a **Controlled-Access** dataset:

1. Create a new directory under `Auto-scripts/Original-Glucose-ML-datasets/` using the following format: `{Dataset}_raw_data/` (see {Dataset} keys below)
2. Place the raw data download in `{Dataset}_raw_data/` and unzip the contents if needed. Leave the unzipped contents as is, this is important for the script to work.
3. The dataset can now be harmonized via `auto-harmonize-CGM-datasets.py` (preferred method) or manually using the sequence of scripts below:
   * `{Dataset}_extract-glucose-data.py`
   * `{Dataset}_metadata.py`


* **Copy-Paste Ready Controlled-Access {Dataset} Keys:** AI-READI, DiaTrend, T1DiabetesGranada, T1DEXI, T1DEXIP, OhioT1DM, Hall_2018 (not controlled-access, but manual download required), Colas_2019 (not controlled-access, but manual download required).

---


<p>&nbsp;</p>

<p align="center">
  <img src="../Logos/glucose-ml-logo_horizontal_white.svg" alt="Glucose-ML logo" width="450">
</p>